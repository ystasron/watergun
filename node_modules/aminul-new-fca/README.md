# Aminul FCA - Facebook Chat API Library

## Overview
A modern Facebook Chat API fork for Node.js applications. This library provides a comprehensive set of functions to interact with Facebook Messenger programmatically.

**Version:** 1.0.29  
**Author:** Aminul Sardar

## Project Structure
```
/
├── index.js           # Main entry point with login, rate limiting, connection monitoring
├── utils.js           # Utility functions (HTTP, parsing, validation, helpers)
├── package.json       # Dependencies and project metadata
├── test.js            # Library validation tests
├── src/               # API function modules
│   ├── sendMessage.js
│   ├── sendBatchMessages.js      # NEW: Send multiple messages with delays
│   ├── scheduleMessage.js        # NEW: Schedule messages for later
│   ├── forwardMessage.js         # NEW: Forward messages to threads
│   ├── getThreadInfo.js
│   ├── getThreadMembers.js       # NEW: Get detailed member info
│   ├── getThreadParticipants.js  # NEW: Get thread participants
│   ├── getThreadHistory.js
│   ├── getRecentMessages.js      # NEW: Get recent messages
│   ├── getUnreadThreads.js       # NEW: Get unread threads
│   ├── getOnlineUsers.js         # NEW: Get online friends
│   ├── getMutualFriends.js       # NEW: Get mutual friends
│   ├── searchMessages.js         # NEW: Search message history
│   ├── setTypingStatus.js        # NEW: Set typing indicator
│   ├── listenMqtt.js
│   └── ... (60+ API modules)
└── src/data/          # Static data files
```

## Recent Changes (v1.0.29)

### index.js Enhancements
- Added **Rate Limiter** - Prevents API abuse with configurable request limits
- Added **Connection Monitor** - Tracks connection health and activity
- Added **Event Emitter** - Emit events for login, shutdown, errors
- Added **Graceful Shutdown** - Clean disconnection helper
- Added utility exports via `login.utils`

### utils.js New Functions
- `retryWithBackoff()` - Retry failed operations with exponential backoff
- `isValidThreadID()` / `isValidUserID()` - ID validation
- `sanitizeMessageBody()` - Clean message content
- `parseTimeString()` - Parse "5m", "1h" to milliseconds
- `deepClone()` - Deep object cloning
- `debounce()` / `throttle()` - Rate limiting helpers
- `generateRandomString()` - Random string generator
- `formatFileSize()` / `formatDuration()` - Formatting helpers
- `parseMentions()` - Extract mentions from messages
- `sleep()` - Async delay utility
- `chunkArray()` / `uniqueArray()` - Array utilities
- `safeJSONParse()` - Safe JSON parsing with default

### New src/ Modules
- `sendBatchMessages.js` - Send multiple messages with configurable delays
- `scheduleMessage.js` - Schedule, cancel, and list scheduled messages
- `forwardMessage.js` - Forward messages to one or more threads
- `getThreadMembers.js` - Get detailed member information
- `getThreadParticipants.js` - Get participant profiles
- `getRecentMessages.js` - Get recent message history
- `getUnreadThreads.js` - List unread conversation threads
- `getOnlineUsers.js` - Get currently online friends
- `getMutualFriends.js` - Get mutual friends with a user
- `searchMessages.js` - Search message content
- `setTypingStatus.js` - Control typing indicator

## Usage Example
```javascript
const login = require('aminul-new-fca');

const appState = require('./appstate.json');

login({ appState }, (err, api) => {
  if (err) return console.error(err);
  
  // Send a message
  api.sendMessage("Hello!", "threadID");
  
  // Send batch messages
  api.sendBatchMessages([
    { threadID: "123", body: "Message 1" },
    { threadID: "456", body: "Message 2" }
  ], { delay: 2000 });
  
  // Schedule a message
  api.scheduleMessage.schedule("Reminder!", "threadID", "1h");
  
  // Listen for messages
  api.listenMqtt((err, event) => {
    if (event.type === "message") {
      console.log(event.body);
    }
  });
});

// Use utility functions
await login.utils.waitForRateLimit();
const health = login.utils.getConnectionHealth();
```

## Key Dependencies
- `axios` - HTTP client
- `mqtt` - MQTT client for real-time messaging
- `request` - HTTP requests
- `node-cron` - Scheduled tasks
- `websocket-stream` - WebSocket support
- `cheerio` - HTML parsing

## Running Tests
```bash
node test.js
```

## Notes
- This is a library meant to be imported by other Node.js projects
- Requires a valid Facebook appstate for authentication
- Rate limiting is built-in to prevent API abuse
- Connection health monitoring available via `login.utils.getConnectionHealth()`
